<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #121212;
            color: #ffffff;
        }

        form {
            max-width: 400px;
            margin: auto;
            text-align: left;
        }

        label,
        input,
        select {
            display: block;
            width: 100%;
            margin-bottom: 10px;
        }

        input,
        select {
            background-color: #1e1e1e;
            color: #ffffff;
            border: 1px solid #333333;
            padding: 8px;
        }

        button {
            padding: 10px 15px;
            cursor: pointer;
            background-color: #333333;
            color: #ffffff;
            border: none;
        }

        button:hover {
            background-color: #444444;
        }

        pre {
            background: #1e1e1e;
            padding: 10px;
            border: 1px solid #333333;
            color: #ffffff;
        }
    </style>
</head>

<body>

    <h2>Fill in the form to generate a JSON file</h2>

    <form id="jsonForm">
        <label for="name">Name:</label>
        <input type="text" id="name" required>

        <label for="version">Version:</label>
        <input type="text" id="version" required>

        <label for="description">Description (optional):</label>
        <input type="text" id="description" placeholder="Description of the component">

        <label for="internal" style="display: flex; align-items: left;">
            Internal:
            <input type="checkbox" id="internal" onclick="toggleVendor()" style="margin: 0px 0px 0px 10px;width: auto;"
                checked>
        </label>

        <label for="vendor">Vendor:</label>
        <input type="text" id="vendor" required placeholder="Balluff" value="Balluff"
            style="background-color: #333333; color: #777777;" disabled>

        <label for="type">Type:</label>
        <select id="type" required>
            <option value="library">Library</option>
            <option value="container">Container</option>
            <option value="application">Application</option>
        </select>

        <label for="license">License:</label>
        <select id="license" required>
            <option value="MIT">MIT</option>
            <option value="Apache-2.0">Apache-2.0</option>
            <option value="GPL-3.0">GPL-3.0</option>
            <option value="BSD-2-Clause">BSD-2-Clause</option>
            <option value="BSD-3-Clause">BSD-3-Clause</option>
            <option value="LGPL-3.0">LGPL-3.0</option>
            <option value="MPL-2.0">MPL-2.0</option>
            <option value="CDDL-1.0">CDDL-1.0</option>
            <option value="EPL-2.0">EPL-2.0</option>
            <option value="Unlicense" selected>Unlicense</option>
        </select>

        <button type="button" onclick="showTemplate()">Show JSON</button>
        <button type="button" onclick="generateJSON()">Download JSON</button>

    </form>

    <pre id="jsonOutput" style="display: none;"></pre>
    <button id="copyButton" style="display: none;" onclick="copyJSON()">Copy JSON</button>

    <script>
        function toggleVendor() {
            const vendorInput = document.getElementById("vendor");
            const internalCheckbox = document.getElementById("internal");
            vendorInput.disabled = internalCheckbox.checked;
            vendorInput.style.backgroundColor = internalCheckbox.checked ? "#333333" : "#1e1e1e";
            vendorInput.style.color = internalCheckbox.checked ? "#777777" : "#ffffff";
        }

        function getComponentTemplate() {
            const name = document.getElementById("name").value;
            const version = document.getElementById("version").value;
            const vendorInput = document.getElementById("vendor");
            const type = document.getElementById("type").value;
            const license = document.getElementById("license").value;
            const internal = document.getElementById("internal").checked;

            const vendor = internal ? "Balluff" : vendorInput.value;

            if (!name || !version || (!vendor && !internal)) {
                alert("Please fill in all fields.");
                return;
            }
            if (name.length < 3 || (!internal && vendor.length < 3)) {
                alert("Name, and Vendor must be at least 3 characters long.");
                return;
            }

            return {
                "bomFormat": "CycloneDX",
                "specVersion": "1.6",
                "version": 1,
                "metadata": {
                    "timestamp": new Date().toISOString(),
                    "component": {
                        "type": type,
                        "name": name,
                        "bom-ref": "urn:uuid:" + crypto.randomUUID(),
                        "group": vendor,
                        "version": version,
                        "description": "Description of the component",
                        "purl": "pkg:" + vendor.toLowerCase() + "/" + name.toLowerCase() + "@" + version.toLowerCase(),
                        "licenses": [
                            {
                                "license": {
                                    "id": license
                                }
                            }
                        ]
                    }
                }
            };
        }

        function generateJSON() {
            const name = document.getElementById("name").value;

            const component_template = getComponentTemplate();
            if (!component_template) {
                return;
            }

            const jsonString = JSON.stringify(component_template, null, 4);
            const blob = new Blob([jsonString], { type: "application/json" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = name.toLowerCase() + "_sbom.json";
            link.click();
        }

        function showTemplate() {
            const name = document.getElementById("name").value;

            const component_template = getComponentTemplate();
            if (!component_template) {
                return;
            }

            const jsonOutput = document.getElementById("jsonOutput");
            jsonOutput.textContent = JSON.stringify(component_template, null, 4);
            jsonOutput.style.display = "block";
            jsonOutput.style.textAlign = "left";
            jsonOutput.style.width = "auto";
            jsonOutput.style.margin = "20px auto";

            const copyButton = document.getElementById("copyButton");
            copyButton.style.display = "block";
        }

        function copyJSON() {
            const jsonOutput = document.getElementById("jsonOutput");
            navigator.clipboard.writeText(jsonOutput.textContent)
                .then(() => alert("JSON copied to clipboard!"))
                .catch(err => alert("Failed to copy JSON: " + err));
        }
    </script>

    <a href="https://cyclonedx.org/docs/1.6/json" target="_blank"
        style="color: #005ec9; text-decoration: none; margin-top: 20px; display: inline-block;">
        CycloneDX JSON Documentation
    </a>

</body>

</html>